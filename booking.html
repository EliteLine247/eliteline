<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eliteline | Booking</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="images/circle_logo.png">

  <!-- Google Maps Extended Component Library -->
  <script type="module"
    src="https://unpkg.com/@googlemaps/extended-component-library@0.6.1">
  </script>

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css">
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>

<!-- â­ REQUIRED LOADER (THIS IS WHAT WAS MISSING) â­ -->
<gmpx-api-loader
  key="AIzaSyDY_Ht1E_M8zy1_GqcnF5llzF-79umXES4"
  solution-channel="GMPX"
  libraries="places"
></gmpx-api-loader>


<header>
  <nav class="navbar">
    <div class="container">
      <div class="logo">
        <a href="index.html">
          <img src="images/circle_logo.png" alt="Eliteline logo">
        </a>
      </div>

      <button class="menu-toggle" aria-label="Open Menu">
        <i class="fas fa-bars"></i>
        <span class="menu-text">Menu</span>
      </button>

      <ul class="nav-links">
        <li><a href="index.html">HOME</a></li>
        <li><a href="services.html">SERVICES</a></li>
        <li><a href="prices.html">PRICE</a></li>
        <li><a href="about_us.html">ABOUT US</a></li>
        <li><a href="booking.html" class="active">BOOKING</a></li>
        <li><a href="terms_conditions.html">TERMS & <br> CONDITIONS</a></li>
      </ul>

      <div class="social-icons">
        <a href="https://www.facebook.com/profile.php?id=61567137089321" target="_blank" class="facebook-icon">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="https://www.instagram.com/elitelineofficial/" target="_blank" class="instagram-icon">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="https://wa.me/447340868719" target="_blank" class="whatsapp-icon">
          <i class="fab fa-whatsapp"></i>
        </a>
      </div>
    </div>
  </nav>
</header>

<br><br><br><br><br>

<section class="curved-section booking-section">
  <h2>Book Your Chauffeur</h2>

  <form id="bookingForm" class="enquiry-form">

    <!-- TRIP TYPE -->
    <div class="trip-tabs">
      <button type="button" class="trip-tab active" data-mode="one_way">One Way</button>
      <button type="button" class="trip-tab" data-mode="return">Return</button>
      <button type="button" class="trip-tab" data-mode="wait_return">Wait & Return</button>
      <button type="button" class="trip-tab" data-mode="hourly">By The Hour</button>
    </div>
    <input type="hidden" id="tripType" name="tripType" value="one_way">

    <!-- CAR CLASS -->
    <div class="car-class-buttons">
      <button type="button" class="car-btn active" data-car="business">Business Class</button>
      <button type="button" class="car-btn" data-car="first">First Class</button>
      <button type="button" class="car-btn" data-car="xl">Business XL</button>
    </div>
    <input type="hidden" name="vehicle" id="vehicle" value="business">


    <!-- FROM / TO -->
    <div id="fromToRow" class="from-to-row">

      <!-- FROM -->
      <div class="from-to-col">
        <div class="from-to-label">From:</div>

        <div class="from-to-toggle">
          <button type="button" class="from-btn active" data-from="fixed">Fixed Fare</button>
          <button type="button" class="from-btn" data-from="address">Address</button>
        </div>

        <div id="fromFixedWrapper" class="premium-select">
          <select id="fromFixedFare" name="fromFixedFare">
            <option value="">Select a fixed fare *</option>
            <optgroup label="Airports">
              <option value="LHR">London Heathrow Airport (LHR)</option>
              <option value="LGW">London Gatwick Airport (LGW)</option>
              <option value="STN">London Stansted Airport (STN)</option>
              <option value="SOU">Southampton Airport (SOU)</option>
              <option value="LTN">London Luton Airport (LTN)</option>
              <option value="BOH">Bournemouth Airport (BOH)</option>
              <option value="LCY">London City Airport (LCY)</option>
              <option value="BQH">London Biggin Hill Airport (BQH)</option>
              <option value="FAB">Farnborough Airport (FAB)</option>
            </optgroup>
            <optgroup label="Cities">
              <option value="BRIGHTON_HOVE">Brighton &amp; Hove</option>
              <option value="PORTSMOUTH">Portsmouth</option>
              <option value="SOUTHAMPTON_CITY">Southampton</option>
              <option value="GUILDFORD">Guildford</option>
              <option value="LONDON_CENTRAL">Central London</option>
            </optgroup>
          </select>
        </div>

        <div id="fromAddressWrapper" class="address-wrapper" style="display:none;">
          <input class="premium-input" type="text" id="fromAddress" name="fromAddress" placeholder="From address *" autocomplete="off">
          <gmpx-place-autocomplete for="fromAddress" country-restrictions="gb"></gmpx-place-autocomplete>
        </div>
      </div>

      <!-- TO -->
      <div class="from-to-col">
        <div class="from-to-label">To:</div>

        <div class="from-to-toggle">
          <button type="button" class="to-btn active" data-to="fixed">Fixed Fare</button>
          <button type="button" class="to-btn" data-to="address">Address</button>
        </div>

        <div id="toFixedWrapper" class="premium-select">
          <select id="toFixedFare" name="toFixedFare">
            <option value="">Select a fixed fare *</option>
            <optgroup label="Airports">
              <option value="LHR">London Heathrow Airport (LHR)</option>
              <option value="LGW">London Gatwick Airport (LGW)</option>
              <option value="STN">London Stansted Airport (STN)</option>
              <option value="SOU">Southampton Airport (SOU)</option>
              <option value="LTN">London Luton Airport (LTN)</option>
              <option value="BOH">Bournemouth Airport (BOH)</option>
              <option value="LCY">London City Airport (LCY)</option>
              <option value="BQH">London Biggin Hill Airport (BQH)</option>
              <option value="FAB">Farnborough Airport (FAB)</option>
            </optgroup>
            <optgroup label="Cities">
              <option value="BRIGHTON_HOVE">Brighton &amp; Hove</option>
              <option value="PORTSMOUTH">Portsmouth</option>
              <option value="SOUTHAMPTON_CITY">Southampton</option>
              <option value="GUILDFORD">Guildford</option>
              <option value="LONDON_CENTRAL">Central London</option>
            </optgroup>
          </select>
        </div>

        <div id="toAddressWrapper" class="address-wrapper" style="display:none;">
          <input class="premium-input" type="text" id="toAddress" name="toAddress" placeholder="To address *" autocomplete="off">
          <gmpx-place-autocomplete for="toAddress" country-restrictions="gb"></gmpx-place-autocomplete>
        </div>
      </div>

    </div>


    <!-- HOURLY -->
    <div id="otherAddressWrapper" style="display:none;">
      <div class="address-wrapper">
        <input class="premium-input" type="text" id="otherPickup" name="otherPickup" placeholder="Pickup location *" autocomplete="off">
        <gmpx-place-autocomplete for="otherPickup" country-restrictions="gb"></gmpx-place-autocomplete>
      </div>

      <div class="address-wrapper">
        <input class="premium-input" type="text" id="otherDropoff" name="otherDropoff" placeholder="Drop-off location *" autocomplete="off">
        <gmpx-place-autocomplete for="otherDropoff" country-restrictions="gb"></gmpx-place-autocomplete>
      </div>
    </div>


    <!-- PASSENGER DETAILS -->
    <input class="premium-input" type="text" name="fullName" placeholder="Full Name *" required>

    <div class="form-row date-time-row">
      <input class="premium-input" type="tel" name="phone" placeholder="Phone Number *" required>
      <input class="premium-input" type="email" name="email" placeholder="Email Address *" required>
    </div>

    <!-- OUTBOUND DATE & TIME -->
    <div class="form-row">
      <div class="input-box">
        <label>Date</label>
        <input type="date" id="date" name="date" class="premium-input" required>
      </div>

      <div class="input-box">
        <label>Time</label>
        <input type="time" id="time" name="time" class="premium-input" required>
      </div>
    </div>

    <!-- RETURN -->
    <div id="returnFields" style="display:none;">
      <h4 style="text-align:center; margin-top:10px; margin-bottom:10px;">Return Journey Details</h4>

      <div class="form-row">
        <div class="input-box">
          <label>Return Date</label>
          <input type="date" id="returnDate" name="returnDate" class="premium-input">
        </div>

        <div class="input-box">
          <label>Return Time</label>
          <input type="time" id="returnTime" name="returnTime" class="premium-input">
        </div>
      </div>
    </div>


    <!-- WAIT & RETURN -->
    <div id="waitHoursWrapper" class="premium-select" style="display:none;">
      <label>How many hours should the driver wait?</label>
      <select id="waitHours" name="waitHours">
        <option value="">Select hours *</option>
        <option value="1">1 hour</option>
        <option value="2">2 hours</option>
        <option value="3">3 hours</option>
        <option value="4">4 hours</option>
        <option value="5">5 hours</option>
        <option value="6">6 hours</option>
      </select>
    </div>


    <!-- AIRPORT EXTRAS -->
    <div id="airportExtras" class="form-row" style="display:none;">
      <div class="input-box">
        <label>Terminal</label>
        <input type="text" id="terminal" name="terminal" class="premium-input" placeholder="Terminal">
      </div>

      <div class="input-box">
        <label>Flight Number</label>
        <input type="text" id="flightNumber" name="flightNumber" class="premium-input" placeholder="Flight Number">
      </div>
    </div>


    <!-- EXTRA STOP -->
    <fieldset class="extras-fieldset">
      <label class="pill">
        <input type="checkbox" id="childSeat" name="childSeat" value="yes">
        <span>Child Seat</span>
      </label>

      <label class="pill">
        <input type="checkbox" id="extraStops" name="extraStops" value="yes">
        <span>Extra Stop(s)</span>
      </label>
    </fieldset>

    <div id="extraStopAddressWrapper" style="display:none;">
      <div class="address-wrapper">
        <input class="premium-input" type="text" id="extraStopAddress" name="extraStopAddress" placeholder="Enter stop address *" autocomplete="off">
        <gmpx-place-autocomplete for="extraStopAddress" country-restrictions="gb"></gmpx-place-autocomplete>
      </div>
    </div>


    <!-- SUBMIT -->
    <button type="submit" class="submit-btn">Proceed to Payment</button>

    <!-- Hidden fields -->
    <input type="hidden" id="pickup" name="pickup">
    <input type="hidden" id="dropoff" name="dropoff">
    <input type="hidden" id="airportCode" name="airportCode">
    <input type="hidden" id="direction" name="direction">
    <input type="hidden" id="pickupPostcode" name="pickupPostcode">
    <input type="hidden" id="pickupSurcharge" name="pickupSurcharge">

  </form>
</section>


<!-- ðŸ”¥ SCRIPT LOGIC (UNCHANGED, WORKS FINE) -->
<script>
  (function () {

    const form = document.getElementById("bookingForm");

    const tripTabs = document.querySelectorAll(".trip-tab");
    const tripTypeInput = document.getElementById("tripType");

    const returnFields = document.getElementById("returnFields");
    const waitHoursWrapper = document.getElementById("waitHoursWrapper");
    const hourlyWrapper = document.getElementById("hourlyWrapper");
    const airportExtras = document.getElementById("airportExtras");

    const fromToRow = document.getElementById("fromToRow");
    const otherAddressWrapper = document.getElementById("otherAddressWrapper");

    const otherPickupInput = document.getElementById("otherPickup");
    const otherDropoffInput = document.getElementById("otherDropoff");

    const carButtons = document.querySelectorAll(".car-btn");
    const vehicleInput = document.getElementById("vehicle");
    const hoursInput = document.getElementById("hours");

    function updateHourlyMinHours() {
      if (!hoursInput) return;
      if (vehicleInput.value === "business") {
        hoursInput.min = 4;
        if (hoursInput.value < 4) hoursInput.value = 4;
      } else {
        hoursInput.min = 5;
        if (hoursInput.value < 5) hoursInput.value = 5;
      }
    }

    carButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        carButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        vehicleInput.value = btn.dataset.car;
        updateHourlyMinHours();
      });
    });

    updateHourlyMinHours();

    const fromButtons = document.querySelectorAll(".from-btn");
    const toButtons = document.querySelectorAll(".to-btn");

    const fromFixedWrapper = document.getElementById("fromFixedWrapper");
    const toFixedWrapper = document.getElementById("toFixedWrapper");

    const fromAddressWrapper = document.getElementById("fromAddressWrapper");
    const toAddressWrapper = document.getElementById("toAddressWrapper");

    const fromFixedSelect = document.getElementById("fromFixedFare");
    const toFixedSelect = document.getElementById("toFixedFare");

    const fromAddressInput = document.getElementById("fromAddress");
    const toAddressInput = document.getElementById("toAddress");

    const AIRPORT_CODES = ["LHR","LGW","STN","SOU","LTN","BOH","LCY","BQH","FAB"];


    function updateAirportExtrasVisibility() {
      if (!airportExtras) return;

      if (tripTypeInput.value === "hourly") {
        airportExtras.style.display = "none";
        return;
      }

      const fromIsFixed = fromFixedWrapper.style.display !== "none";
      const toIsFixed = toFixedWrapper.style.display !== "none";

      const fromCode = fromIsFixed ? fromFixedSelect.value : "";
      const toCode = toIsFixed ? toFixedSelect.value : "";

      const show =
        (fromIsFixed && AIRPORT_CODES.includes(fromCode)) ||
        (toIsFixed && AIRPORT_CODES.includes(toCode));

      airportExtras.style.display = show ? "flex" : "none";
    }


    function setFromType(type) {
      fromButtons.forEach(b => b.classList.toggle("active", b.dataset.from === type));
      fromFixedWrapper.style.display = type === "fixed" ? "block" : "none";
      fromAddressWrapper.style.display = type === "address" ? "block" : "none";
      updateAirportExtrasVisibility();
    }

    function setToType(type) {
      toButtons.forEach(b => b.classList.toggle("active", b.dataset.to === type));
      toFixedWrapper.style.display = type === "fixed" ? "block" : "none";
      toAddressWrapper.style.display = type === "address" ? "block" : "none";
      updateAirportExtrasVisibility();
    }


    fromButtons.forEach(btn =>
      btn.addEventListener("click", () => setFromType(btn.dataset.from))
    );
    toButtons.forEach(btn =>
      btn.addEventListener("click", () => setToType(btn.dataset.to))
    );

    fromFixedSelect.addEventListener("change", updateAirportExtrasVisibility);
    toFixedSelect.addEventListener("change", updateAirportExtrasVisibility);

    setFromType("fixed");
    setToType("fixed");


    function setTrip(mode) {
      tripTypeInput.value = mode;

      tripTabs.forEach(b => b.classList.toggle("active", b.dataset.mode === mode));

      returnFields.style.display = mode === "return" ? "block" : "none";
      waitHoursWrapper.style.display = mode === "wait_return" ? "block" : "none";
      hourlyWrapper.style.display = mode === "hourly" ? "block" : "none";

      if (mode === "hourly") {
        fromToRow.style.display = "none";
        otherAddressWrapper.style.display = "block";
        otherDropoffInput.style.display = "none";
      } else {
        fromToRow.style.display = "flex";
        otherAddressWrapper.style.display = "none";
        otherDropoffInput.style.display = "block";
      }

      updateAirportExtrasVisibility();
    }


    tripTabs.forEach(btn =>
      btn.addEventListener("click", () => setTrip(btn.dataset.mode))
    );

    setTrip("one_way");


    const extraStopsCheckbox = document.getElementById("extraStops");
    const extraStopAddressWrapper = document.getElementById("extraStopAddressWrapper");

    extraStopsCheckbox.addEventListener("change", () => {
      extraStopAddressWrapper.style.display = extraStopsCheckbox.checked ? "block" : "none";
    });


    const pickupHidden = document.getElementById("pickup");
    const dropoffHidden = document.getElementById("dropoff");
    const airportCodeHidden = document.getElementById("airportCode");
    const directionHidden = document.getElementById("direction");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const tripType = tripTypeInput.value;

      let pickup = "";
      let dropoff = "";
      let airportCode = "";
      let direction = "";

      if (tripType === "hourly") {
        pickup = (otherPickupInput?.value || "").trim();
        dropoff = "";
        direction = "HOURLY";
      } else {
        const fromIsFixed = fromFixedWrapper.style.display !== "none";
        const toIsFixed = toFixedWrapper.style.display !== "none";

        pickup = fromIsFixed
          ? (fromFixedSelect.options[fromFixedSelect.selectedIndex] || {}).text || ""
          : (fromAddressInput?.value || "");

        dropoff = toIsFixed
          ? (toFixedSelect.options[toFixedSelect.selectedIndex] || {}).text || ""
          : (toAddressInput?.value || "");

        const fromCode = fromIsFixed ? fromFixedSelect.value : "";
        const toCode = toIsFixed ? toFixedSelect.value : "";

        const fromIsAirport = fromIsFixed && AIRPORT_CODES.includes(fromCode);
        const toIsAirport = toIsFixed && AIRPORT_CODES.includes(toCode);

        if (fromIsAirport) airportCode = fromCode;
        else if (toIsAirport) airportCode = toCode;

        if (fromIsAirport && !toIsAirport) direction = "AIRPORT_TO_ADDRESS";
        else if (!fromIsAirport && toIsAirport) direction = "ADDRESS_TO_AIRPORT";
        else if (fromIsAirport && toIsAirport) direction = "AIRPORT_TO_AIRPORT";
        else direction = "OTHER";
      }

      pickupHidden.value = pickup;
      dropoffHidden.value = dropoff;
      airportCodeHidden.value = airportCode;
      directionHidden.value = direction;

      const data = Object.fromEntries(new FormData(form).entries());

      try {
        const res = await fetch("/api/create-booking", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        const json = await res.json();

        if (res.ok && json.paymentUrl) {
          window.location.href = json.paymentUrl;
        } else {
          alert("Booking error: " + (json.error || "Unknown error"));
        }
      } catch (err) {
        alert("Network error â€” please try again.");
      }
    });

  })();
</script>

<footer>
  <p>
    Copyright All Rights Reserved Â© 2025 |
    Eliteline, Chichester District Council. Operator's Licence Number: 381, United Kingdom.
    Company Registration Number: 16871447
    <a href="privacy_policy.html" style="color:#000;">Privacy Policy</a>
  </p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>AOS.init();</script>

<script>
document.addEventListener("scroll", function () {
  const header = document.querySelector("header");
  header.style.top = window.scrollY > 50 ? "0" : "-100px";
});
</script>

<script>
document.querySelector(".menu-toggle").addEventListener("click", function () {
  document.querySelector(".nav-links").classList.toggle("active");
});
</script>

</body>
</html>
